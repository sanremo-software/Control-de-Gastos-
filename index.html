<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>C√ÇMARA TESTE</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #333;
      font-family: Arial, sans-serif;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    h1 {
      color: white;
      margin: 20px 0;
      text-align: center;
    }
    
    .camera-container {
      width: 100%;
      max-width: 500px;
      background: black;
      border-radius: 20px;
      overflow: hidden;
      margin: 20px 0;
      position: relative;
      aspect-ratio: 4/3;
    }
    
    #video, #canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .controls {
      width: 100%;
      max-width: 500px;
      background: white;
      border-radius: 20px;
      padding: 20px;
      margin: 10px 0;
    }
    
    input, select, button {
      width: 100%;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    
    button {
      background: #007bff;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    .error {
      background: #ff4444;
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
      display: none;
    }
    
    .success {
      background: #00C851;
      color: white;
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    
    .step {
      background: #f0f0f0;
      padding: 15px;
      border-radius: 10px;
      margin: 10px 0;
    }
    
    .step h3 {
      color: #333;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>üì± TESTE DE C√ÇMARA</h1>
  
  <div class="camera-container">
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>
  </div>
  
  <div class="controls">
    <div class="step">
      <h3>Passo 1: Ativar C√¢mara</h3>
      <button id="btnAtivar">üì∏ ATIVAR C√ÇMARA</button>
    </div>
    
    <div class="step">
      <h3>Passo 2: Escrever Texto</h3>
      <input type="text" id="texto" value="PARAB√âNS" placeholder="Digite o texto">
      <button id="btnAtualizar">‚úì Atualizar Texto</button>
    </div>
    
    <div class="step">
      <h3>Passo 3: Ajustar</h3>
      <label>Tamanho: <span id="tamanhoValor">80</span></label>
      <input type="range" id="tamanho" min="30" max="200" value="80">
      
      <label>Posi√ß√£o Y: <span id="yValor">0</span></label>
      <input type="range" id="posY" min="-200" max="200" value="0">
    </div>
    
    <div class="step">
      <h3>Passo 4: Modo Proje√ß√£o</h3>
      <button id="btnProjecao">üåô ATIVAR PROJE√á√ÉO</button>
    </div>
    
    <div id="erro" class="error"></div>
    <div id="sucesso" class="success" style="display: none;">
      ‚úÖ C√¢mara ativada com sucesso!
    </div>
  </div>

  <script>
    // Elementos
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Estado
    let cameraAtiva = false;
    let projecaoAtiva = false;
    let texto = "PARAB√âNS";
    let tamanho = 80;
    let posY = 0;
    
    // Fun√ß√£o para ativar c√¢mara
    document.getElementById('btnAtivar').addEventListener('click', async () => {
      const erroDiv = document.getElementById('erro');
      const sucessoDiv = document.getElementById('sucesso');
      
      try {
        erroDiv.style.display = 'none';
        sucessoDiv.style.display = 'none';
        
        console.log('A pedir c√¢mara...');
        
        // Pedir acesso √† c√¢mara - Isto VAI mostrar o popup!
        const stream = await navigator.mediaDevices.getUserMedia({ 
          video: {
            facingMode: 'environment', // C√¢mara traseira
            width: { ideal: 1280 },
            height: { ideal: 720 }
          }
        });
        
        console.log('C√¢mara obtida!');
        
        // Mostrar v√≠deo
        video.srcObject = stream;
        
        video.onloadedmetadata = () => {
          console.log('V√≠deo carregado');
          
          // Ajustar canvas
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          
          // Iniciar reprodu√ß√£o
          video.play();
          
          // Marcar como ativa
          cameraAtiva = true;
          
          // Mostrar sucesso
          sucessoDiv.style.display = 'block';
          
          // Iniciar desenho
          desenhar();
        };
        
      } catch (err) {
        console.error('Erro:', err);
        
        // Mostrar erro detalhado
        let mensagem = '';
        
        if (err.name === 'NotAllowedError') {
          mensagem = '‚ùå Permiss√£o negada. No seu telem√≥vel:';
          mensagem += '\n\nüì± ANDROID:';
          mensagem += '\n1. Abra Defini√ß√µes';
          mensagem += '\n2. Apps > Chrome';
          mensagem += '\n3. Permiss√µes > C√¢mara = Permitir';
          mensagem += '\n4. Recarregue a p√°gina';
          mensagem += '\n\nüì± IPHONE:';
          mensagem += '\n1. Defini√ß√µes > Safari';
          mensagem += '\n2. C√¢mara = Permitir';
          mensagem += '\n3. Recarregue a p√°gina';
        } else if (err.name === 'NotFoundError') {
          mensagem = '‚ùå Nenhuma c√¢mara encontrada no seu dispositivo';
        } else {
          mensagem = '‚ùå Erro: ' + err.message;
        }
        
        erroDiv.innerHTML = mensagem.replace(/\n/g, '<br>');
        erroDiv.style.display = 'block';
      }
    });
    
    // Fun√ß√£o de desenho
    function desenhar() {
      if (!cameraAtiva) {
        requestAnimationFrame(desenhar);
        return;
      }
      
      // Limpar canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Centro
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const raio = Math.min(canvas.width, canvas.height) * 0.3;
      
      // Configurar estilo
      if (projecaoAtiva) {
        ctx.strokeStyle = '#FFD700';
        ctx.fillStyle = '#FFD700';
        ctx.shadowColor = '#FFD700';
        ctx.shadowBlur = 30;
        ctx.lineWidth = 15;
      } else {
        ctx.strokeStyle = '#FFFFFF';
        ctx.fillStyle = '#FFFFFF';
        ctx.shadowColor = '#000000';
        ctx.shadowBlur = 10;
        ctx.lineWidth = 8;
      }
      
      ctx.shadowOffsetX = 0;
      ctx.shadowOffsetY = 0;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      
      // Desenhar c√≠rculo
      ctx.beginPath();
      ctx.arc(centerX, centerY, raio, 0, Math.PI * 2);
      ctx.stroke();
      
      // Desenhar texto
      ctx.font = `${tamanho}px "Arial", sans-serif`;
      ctx.fillText(texto, centerX, centerY + posY);
      
      requestAnimationFrame(desenhar);
    }
    
    // Atualizar texto
    document.getElementById('btnAtualizar').addEventListener('click', () => {
      texto = document.getElementById('texto').value;
    });
    
    // Tamanho
    document.getElementById('tamanho').addEventListener('input', (e) => {
      tamanho = parseInt(e.target.value);
      document.getElementById('tamanhoValor').innerText = tamanho;
    });
    
    // Posi√ß√£o Y
    document.getElementById('posY').addEventListener('input', (e) => {
      posY = parseInt(e.target.value);
      document.getElementById('yValor').innerText = posY;
    });
    
    // Modo proje√ß√£o
    document.getElementById('btnProjecao').addEventListener('click', () => {
      projecaoAtiva = !projecaoAtiva;
      const btn = document.getElementById('btnProjecao');
      
      if (projecaoAtiva) {
        btn.innerHTML = '‚ö™ DESATIVAR PROJE√á√ÉO';
        btn.style.background = '#333';
        
        // Wake Lock
        if ('wakeLock' in navigator) {
          navigator.wakeLock.request('screen').catch(() => {});
        }
      } else {
        btn.innerHTML = 'üåô ATIVAR PROJE√á√ÉO';
        btn.style.background = '#007bff';
      }
    });
    
    // Tecla Enter no input
    document.getElementById('texto').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        texto = e.target.value;
      }
    });
  </script>
</body>
</html>
