<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√ÇMARA + TEXTO - VERS√ÉO FUNCIONAL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: white;
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        /* √Årea da c√¢mara */
        .camera-section {
            position: relative;
            flex: 1;
            background: #1a1a1a;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }
        
        /* Mensagem quando n√£o h√° c√¢mara */
        .no-camera {
            position: absolute;
            color: white;
            text-align: center;
            z-index: 2;
            background: rgba(255,0,0,0.5);
            padding: 20px;
            border-radius: 20px;
            display: none;
        }
        
        /* Controlos */
        .controls {
            background: #222;
            padding: 20px;
            border-top: 2px solid gold;
        }
        
        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .input-row input {
            flex: 1;
            padding: 15px;
            font-size: 20px;
            border-radius: 30px;
            border: 2px solid gold;
            background: #333;
            color: white;
        }
        
        .input-row button {
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 30px;
            border: none;
            background: gold;
            color: black;
            font-weight: bold;
            cursor: pointer;
        }
        
        .slider-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
        }
        
        .slider-row label {
            width: 60px;
            color: gold;
            font-size: 20px;
        }
        
        .slider-row input {
            flex: 1;
            height: 10px;
            -webkit-appearance: none;
            background: #444;
            border-radius: 10px;
        }
        
        .slider-row input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 30px;
            height: 30px;
            background: gold;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .slider-row span {
            width: 50px;
            text-align: right;
            color: white;
            font-size: 18px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 15px;
            border-radius: 30px;
            border: none;
            background: #444;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        
        .btn-gold {
            background: gold;
            color: black;
            font-weight: bold;
        }
        
        .status {
            text-align: center;
            margin-top: 10px;
            padding: 10px;
            border-radius: 30px;
            background: #333;
            color: gold;
        }
        
        .error {
            background: #ff4444;
            color: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- √Årea da c√¢mara -->
    <div class="camera-section">
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
        <div class="no-camera" id="noCamera">
            üì∑ Clique no bot√£o para ativar a c√¢mara
        </div>
    </div>
    
    <!-- Controlos -->
    <div class="controls">
        <div class="input-row">
            <input type="text" id="textInput" value="PARAB√âNS" placeholder="Digite o texto...">
            <button id="updateBtn">OK</button>
        </div>
        
        <div class="slider-row">
            <label>üìè</label>
            <input type="range" id="sizeSlider" min="30" max="250" value="100">
            <span id="sizeValue">100</span>
        </div>
        
        <div class="slider-row">
            <label>‚¨ÜÔ∏è</label>
            <input type="range" id="ySlider" min="-300" max="300" value="0">
            <span id="yValue">0</span>
        </div>
        
        <div class="button-grid">
            <button class="btn" id="cameraBtn">üì∏ INICIAR C√ÇMARA</button>
            <button class="btn btn-gold" id="projectBtn">üåô PROJE√á√ÉO</button>
        </div>
        
        <div class="status" id="status">
            ‚ö™ Clique em INICIAR C√ÇMARA
        </div>
        
        <div class="error" id="error"></div>
    </div>
</div>

<script>
    // Elementos
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    
    // Estado
    let cameraAtiva = false;
    let projecaoAtiva = false;
    let texto = "PARAB√âNS";
    let tamanho = 100;
    let posY = 0;
    
    // Fun√ß√£o para iniciar c√¢mara
    document.getElementById('cameraBtn').addEventListener('click', async () => {
        const status = document.getElementById('status');
        const error = document.getElementById('error');
        
        status.innerHTML = "‚è≥ A pedir acesso √† c√¢mara...";
        error.style.display = 'none';
        
        try {
            // Verificar se o navegador suporta
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                throw new Error('Navegador n√£o suporta c√¢mara');
            }
            
            // PEDIR ACESSO √Ä C√ÇMARA - Isto mostra o popup!
            console.log("A pedir c√¢mara...");
            
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: {
                    facingMode: 'environment', // C√¢mara traseira
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            });
            
            console.log("C√¢mara OK!");
            
            // MOSTRAR V√çDEO
            video.srcObject = stream;
            
            video.onloadedmetadata = () => {
                console.log("V√≠deo carregado");
                
                // Ajustar canvas ao tamanho do v√≠deo
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Iniciar reprodu√ß√£o
                video.play();
                
                cameraAtiva = true;
                
                // Atualizar status
                status.innerHTML = "‚úÖ C√ÇMARA ATIVA - A ver bolo!";
                document.getElementById('noCamera').style.display = 'none';
                
                // Iniciar desenho
                desenhar();
            };
            
        } catch (err) {
            console.error("Erro detalhado:", err);
            
            let mensagem = "‚ùå ";
            
            if (err.name === 'NotAllowedError') {
                mensagem = "‚ùå PERMISS√ÉO NEGADA!\n\n";
                mensagem += "No seu telem√≥vel:\n";
                mensagem += "1. Abra Defini√ß√µes\n";
                mensagem += "2. Apps > Chrome\n";
                mensagem += "3. Permiss√µes > C√¢mara = Permitir\n";
                mensagem += "4. Recarregue a p√°gina e tente novamente";
            } 
            else if (err.name === 'NotFoundError') {
                mensagem = "‚ùå Nenhuma c√¢mara encontrada";
            }
            else {
                mensagem = "‚ùå Erro: " + err.message;
            }
            
            error.innerHTML = mensagem.replace(/\n/g, '<br>');
            error.style.display = 'block';
            status.innerHTML = "‚ùå Falhou";
        }
    });
    
    // Fun√ß√£o de desenho
    function desenhar() {
        if (!cameraAtiva) {
            requestAnimationFrame(desenhar);
            return;
        }
        
        // Limpar canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Centro
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        
        // Configurar estilo
        if (projecaoAtiva) {
            ctx.fillStyle = '#FFD700';
            ctx.shadowColor = '#FFD700';
            ctx.shadowBlur = 30;
        } else {
            ctx.fillStyle = '#FFFFFF';
            ctx.shadowColor = '#000000';
            ctx.shadowBlur = 10;
        }
        
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        
        // Desenhar texto
        ctx.font = `bold ${tamanho}px Arial, sans-serif`;
        ctx.fillText(texto, centerX, centerY + posY);
        
        // Desenhar c√≠rculo de teste (para confirmar que o canvas funciona)
        ctx.strokeStyle = projecaoAtiva ? '#FFD700' : '#FFFFFF';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(centerX, centerY, 30, 0, Math.PI * 2);
        ctx.stroke();
        
        requestAnimationFrame(desenhar);
    }
    
    // Atualizar texto
    document.getElementById('updateBtn').addEventListener('click', () => {
        texto = document.getElementById('textInput').value;
    });
    
    // Sliders
    document.getElementById('sizeSlider').addEventListener('input', (e) => {
        tamanho = parseInt(e.target.value);
        document.getElementById('sizeValue').innerText = tamanho;
    });
    
    document.getElementById('ySlider').addEventListener('input', (e) => {
        posY = parseInt(e.target.value);
        document.getElementById('yValue').innerText = posY;
    });
    
    // Modo proje√ß√£o
    document.getElementById('projectBtn').addEventListener('click', () => {
        projecaoAtiva = !projecaoAtiva;
        const btn = document.getElementById('projectBtn');
        const status = document.getElementById('status');
        
        if (projecaoAtiva) {
            btn.innerHTML = '‚ö™ NORMAL';
            btn.style.background = '#444';
            status.innerHTML = '‚ú® PROJE√á√ÉO ATIVA - Linhas douradas';
        } else {
            btn.innerHTML = 'üåô PROJE√á√ÉO';
            btn.style.background = 'gold';
            status.innerHTML = '‚úÖ C√¢mara ativa - Texto branco';
        }
    });
    
    // Tecla Enter
    document.getElementById('textInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            texto = e.target.value;
        }
    });
</script>
</body>
</html>
