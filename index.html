<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Sanremo Torten-Schablone Pro ‚ú¶ Der perfekte Schatten</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Dancing+Script:wght@400..700&family=Great+Vibes&family=Kaushan+Script&family=Lobster&family=Montserrat:wght@300;400;600;700&family=Open+Sans:wght@300..800&family=Oswald:wght@200..700&family=Pacifico&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Poppins:wght@300;400;600&family=Raleway:wght@300;400;600&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #2d2d2d;
      --secondary: #6b6b6b;
      --accent: #d4af37;
      --bg: #f5f5f7;
      --card: #ffffff;
      --text: #1e1e1e;
      --border: #e0e0e0;
      --shadow: 0 8px 30px rgba(0, 0, 0, 0.05);
      --radius: 24px;
      --radius-sm: 16px;
    }
    
    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    /* Header */
    .header {
      background: var(--card);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo i {
      font-size: 28px;
      color: var(--accent);
    }
    
    .logo h1 {
      font-size: 20px;
      font-weight: 600;
      background: linear-gradient(135deg, #333, #000);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .header-badges {
      display: flex;
      gap: 12px;
    }
    
    .badge {
      padding: 8px 16px;
      border-radius: 40px;
      background: #f0f0f0;
      font-size: 13px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .badge i {
      color: var(--accent);
    }
    
    .btn {
      padding: 10px 20px;
      border-radius: 40px;
      border: 1px solid var(--border);
      background: white;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }
    
    .btn:hover {
      background: #f8f8f8;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
    }
    
    .btn-primary:hover {
      background: #000;
    }
    
    .btn-accent {
      background: var(--accent);
      color: black;
      border: none;
    }
    
    /* Main Layout */
    .app-container {
      display: grid;
      grid-template-columns: 380px 1fr;
      gap: 20px;
      padding: 20px;
      flex: 1;
    }
    
    /* Sidebar */
    .sidebar {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow-y: auto;
      max-height: calc(100vh - 100px);
      padding: 20px;
    }
    
    .section {
      margin-bottom: 28px;
      border-bottom: 1px solid #eee;
      padding-bottom: 20px;
    }
    
    .section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--primary);
    }
    
    .section-title i {
      color: var(--accent);
      width: 24px;
    }
    
    .control-group {
      margin-bottom: 16px;
    }
    
    .control-row {
      display: flex;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    
    .control-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--secondary);
      margin-bottom: 6px;
    }
    
    .control-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 30px;
      font-size: 14px;
      transition: all 0.2s;
      background: #fafafa;
    }
    
    .control-input:focus {
      outline: none;
      border-color: var(--accent);
      background: white;
    }
    
    .range-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .range-group input[type="range"] {
      flex: 1;
      height: 6px;
      -webkit-appearance: none;
      background: #e0e0e0;
      border-radius: 10px;
    }
    
    .range-group input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .range-value {
      min-width: 45px;
      text-align: center;
      font-size: 13px;
      font-weight: 600;
      color: var(--primary);
    }
    
    .select-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .motif-option {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px 8px;
      text-align: center;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }
    
    .motif-option i {
      font-size: 24px;
      display: block;
      margin-bottom: 6px;
      color: var(--secondary);
    }
    
    .motif-option.selected {
      border-color: var(--accent);
      background: #fef9e7;
    }
    
    .motif-option.selected i {
      color: var(--accent);
    }
    
    /* Canvas Area */
    .canvas-container {
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    
    .canvas-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .canvas-title {
      font-weight: 600;
    }
    
    .canvas-controls {
      display: flex;
      gap: 8px;
    }
    
    .stage-wrapper {
      position: relative;
      aspect-ratio: 1/1;
      width: 100%;
      background: #ffffff;
      border-radius: var(--radius-sm);
      overflow: hidden;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,0.05);
      margin-bottom: 16px;
    }
    
    .stage {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      transition: background 0.2s;
    }
    
    .stage.shadow-mode {
      background: #ffffff !important;
    }
    
    .stage svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    
    /* Calibration Bar */
    .calibration-bar {
      background: #f0f0f0;
      border-radius: 40px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
    }
    
    .card-reference {
      background: linear-gradient(45deg, #2a6f97, #1e4a6b);
      color: white;
      padding: 8px 16px;
      border-radius: 30px;
      font-size: 13px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    /* Footer */
    .footer {
      margin-top: auto;
      padding: 20px;
      text-align: center;
      color: var(--secondary);
      font-size: 13px;
      border-top: 1px solid var(--border);
    }
    
    /* Utility Classes */
    .hidden {
      display: none !important;
    }
    
    .flex {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .text-accent {
      color: var(--accent);
    }
    
    /* Fullscreen */
  .fullscreen-mode .header,
    .fullscreen-mode .sidebar,
    .fullscreen-mode .canvas-header,
    .fullscreen-mode .calibration-bar,
    .fullscreen-mode .footer {
      display: none;
    }
    
    .fullscreen-mode .app-container {
      grid-template-columns: 1fr;
      padding: 0;
    }
    
    .fullscreen-mode .canvas-container {
      border-radius: 0;
      padding: 0;
    }
    
    .fullscreen-mode .stage-wrapper {
      border-radius: 0;
      margin: 0;
    }
    
    /* Mobile */
    @media (max-width: 768px) {
      .app-container {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        max-height: none;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">
      <i class="fas fa-cake-candles"></i>
      <h1>Sanremo Torten-Schablone Pro</h1>
    </div>
    <div class="header-badges">
      <div class="badge" id="mode-badge">
        <i class="fas fa-moon"></i>
        <span>Normal</span>
      </div>
      <div class="badge">
        <i class="fas fa-ruler-combined"></i>
        <span id="size-display">20 cm</span>
      </div>
    </div>
  </div>
  
  <div class="app-container">
    <!-- Sidebar / Controls -->
    <div class="sidebar">
      <!-- Section 1: Gr√∂√üe & Kalibrierung -->
      <div class="section">
        <div class="section-title">
          <i class="fas fa-arrows-up-down"></i>
          <span>1. Gr√∂√üe & Kalibrierung</span>
        </div>
        
        <div class="control-group">
          <div class="control-label">Tortendurchmesser</div>
          <div class="control-row">
            <button class="btn" onclick="setDiameter(18)">18 cm</button>
            <button class="btn btn-primary" onclick="setDiameter(20)">20 cm</button>
            <button class="btn" onclick="setDiameter(24)">24 cm</button>
            <button class="btn" onclick="setDiameter(26)">26 cm</button>
            <button class="btn" onclick="setDiameter(28)">28 cm</button>
          </div>
        </div>
        
        <div class="control-group">
          <div class="control-label">Kalibrierung (px/mm)</div>
          <div class="range-group">
            <input type="range" id="pxPerMm" min="2" max="10" step="0.1" value="4.2">
            <span class="range-value" id="pxPerMmValue">4.2</span>
          </div>
          <div style="font-size: 12px; color: #666; margin-top: 6px;">
            <i class="fas fa-credit-card"></i> Lege eine Bankkarte auf: 85.6 mm breit
          </div>
        </div>
        
        <div class="calibration-bar">
          <div class="card-reference"><i class="fas fa-credit-card"></i> 85.6 mm</div>
          <div style="flex: 1; text-align: center; font-weight: 500;" id="calibration-readout">
            Karte: -- mm auf Bildschirm
          </div>
        </div>
      </div>
      
      <!-- Section 2: Text -->
      <div class="section">
        <div class="section-title">
          <i class="fas fa-font"></i>
          <span>2. Text & Schrift</span>
        </div>
        
        <div class="control-group">
          <div class="control-label">Text eingeben</div>
          <input type="text" class="control-input" id="customerText" value="Alles Gute zum Geburtstag!" placeholder="Dein Text...">
        </div>
        
        <div class="control-group">
          <div class="control-label">Schriftart</div>
          <select class="control-input" id="fontChoice">
            <optgroup label="üéÄ Schreibschriften">
              <option value="Great Vibes" selected>Great Vibes (elegant)</option>
              <option value="Dancing Script">Dancing Script</option>
              <option value="Pacifico">Pacifico (verspielt)</option>
              <option value="Caveat">Caveat (handschrift)</option>
              <option value="Kaushan Script">Kaushan Script</option>
            </optgroup>
            <optgroup label="üìê Serif">
              <option value="Playfair Display">Playfair Display</option>
              <option value="Georgia">Georgia</option>
            </optgroup>
            <optgroup label="üî§ Sans Serif">
              <option value="Montserrat">Montserrat</option>
              <option value="Poppins">Poppins</option>
              <option value="Open Sans">Open Sans</option>
              <option value="Raleway">Raleway</option>
              <option value="Oswald">Oswald</option>
            </optgroup>
          </select>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">Gr√∂√üe %</div>
            <div class="range-group">
              <input type="range" id="textScale" min="30" max="200" value="100">
              <span class="range-value" id="textScaleValue">100</span>
            </div>
          </div>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">Position X</div>
            <div class="range-group">
              <input type="range" id="textX" min="-250" max="250" value="0">
              <span class="range-value" id="textXValue">0</span>
            </div>
          </div>
          <div style="flex: 1;">
            <div class="control-label">Position Y</div>
            <div class="range-group">
              <input type="range" id="textY" min="-250" max="250" value="0">
              <span class="range-value" id="textYValue">0</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Section 3: Alter -->
      <div class="section">
        <div class="section-title">
          <i class="fas fa-cake-candles"></i>
          <span>3. Alter (optional)</span>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">Alter</div>
            <select class="control-input" id="age">
              <option value="0">Kein Alter</option>
              <option value="1">1 Jahr</option>
              <option value="2">2 Jahre</option>
              <option value="3">3 Jahre</option>
              <option value="4">4 Jahre</option>
              <option value="5">5 Jahre</option>
              <option value="6">6 Jahre</option>
              <option value="7">7 Jahre</option>
              <option value="8">8 Jahre</option>
              <option value="9">9 Jahre</option>
              <option value="10">10 Jahre</option>
              <option value="11">11 Jahre</option>
              <option value="12">12 Jahre</option>
              <option value="13">13 Jahre</option>
              <option value="14">14 Jahre</option>
              <option value="15">15 Jahre</option>
              <option value="16">16 Jahre</option>
              <option value="18">18 Jahre</option>
              <option value="20">20 Jahre</option>
              <option value="30">30 Jahre</option>
              <option value="40">40 Jahre</option>
              <option value="50">50 Jahre</option>
              <option value="60">60 Jahre</option>
            </select>
          </div>
          <div style="flex: 1;">
            <div class="control-label">Gr√∂√üe %</div>
            <div class="range-group">
              <input type="range" id="ageScale" min="40" max="250" value="150">
              <span class="range-value" id="ageScaleValue">150</span>
            </div>
          </div>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">Position Y</div>
            <div class="range-group">
              <input type="range" id="ageY" min="-280" max="280" value="-40">
              <span class="range-value" id="ageYValue">-40</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Section 4: Motive -->
      <div class="section">
        <div class="section-title">
          <i class="fas fa-paintbrush"></i>
          <span>4. Motive</span>
        </div>
        
        <div class="control-group">
          <div class="control-label">Motiv w√§hlen</div>
          <div class="select-grid" id="motif-grid">
            <div class="motif-option selected" data-motif="none"><i class="fas fa-ban"></i> Keins</div>
            <div class="motif-option" data-motif="heart"><i class="fas fa-heart" style="color: #ff6b6b;"></i> Herz</div>
            <div class="motif-option" data-motif="star"><i class="fas fa-star" style="color: #f1c40f;"></i> Stern</div>
            <div class="motif-option" data-motif="crown"><i class="fas fa-crown" style="color: #d4af37;"></i> Krone</div>
            <div class="motif-option" data-motif="bear"><i class="fas fa-bear"></i> B√§r</div>
            <div class="motif-option" data-motif="dog"><i class="fas fa-dog"></i> Hund</div>
            <div class="motif-option" data-motif="cat"><i class="fas fa-cat"></i> Katze</div>
            <div class="motif-option" data-motif="dino"><i class="fas fa-dragon"></i> Dino</div>
            <div class="motif-option" data-motif="unicorn"><i class="fas fa-horse"></i> Einhorn</div>
            <div class="motif-option" data-motif="car"><i class="fas fa-car"></i> Auto</div>
            <div class="motif-option" data-motif="ball"><i class="fas fa-futbol"></i> Ball</div>
            <div class="motif-option" data-motif="cake"><i class="fas fa-cake-candles"></i> Torte</div>
          </div>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">Gr√∂√üe %</div>
            <div class="range-group">
              <input type="range" id="motifScale" min="30" max="250" value="120">
              <span class="range-value" id="motifScaleValue">120</span>
            </div>
          </div>
          <div style="flex: 1;">
            <div class="control-label">Rotation ¬∞</div>
            <div class="range-group">
              <input type="range" id="motifRot" min="-180" max="180" value="0">
              <span class="range-value" id="motifRotValue">0</span>
            </div>
          </div>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">Position X</div>
            <div class="range-group">
              <input type="range" id="motifX" min="-280" max="280" value="0">
              <span class="range-value" id="motifXValue">0</span>
            </div>
          </div>
          <div style="flex: 1;">
            <div class="control-label">Position Y</div>
            <div class="range-group">
              <input type="range" id="motifY" min="-280" max="280" value="-60">
              <span class="range-value" id="motifYValue">-60</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Section 5: Freihand -->
      <div class="section">
        <div class="section-title">
          <i class="fas fa-pencil"></i>
          <span>5. Freihand zeichnen</span>
        </div>
        
        <div class="control-row">
          <button class="btn" id="drawToggleBtn" style="flex: 1;">
            <i class="fas fa-paint-brush"></i> Zeichenmodus: AUS
          </button>
          <button class="btn" id="clearDrawBtn">
            <i class="fas fa-trash"></i>
          </button>
          <button class="btn" id="undoDrawBtn">
            <i class="fas fa-undo"></i>
          </button>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">Linienst√§rke</div>
            <div class="range-group">
              <input type="range" id="drawWidth" min="2" max="20" value="6">
              <span class="range-value" id="drawWidthValue">6</span>
            </div>
          </div>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">Gr√∂√üe %</div>
            <div class="range-group">
              <input type="range" id="drawScale" min="30" max="250" value="100">
              <span class="range-value" id="drawScaleValue">100</span>
            </div>
          </div>
          <div style="flex: 1;">
            <div class="control-label">Rotation</div>
            <div class="range-group">
              <input type="range" id="drawRot" min="-180" max="180" value="0">
              <span class="range-value" id="drawRotValue">0</span>
            </div>
          </div>
        </div>
        
        <div class="control-row">
          <div style="flex: 1;">
            <div class="control-label">X</div>
            <div class="range-group">
              <input type="range" id="drawX" min="-280" max="280" value="0">
              <span class="range-value" id="drawXValue">0</span>
            </div>
          </div>
          <div style="flex: 1;">
            <div class="control-label">Y</div>
            <div class="range-group">
              <input type="range" id="drawY" min="-280" max="280" value="60">
              <span class="range-value" id="drawYValue">60</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Section 6: Extras -->
      <div class="section">
        <div class="section-title">
          <i class="fas fa-sliders"></i>
          <span>6. Extras</span>
        </div>
        
        <div class="control-row">
          <button class="btn" onclick="rotateStage()">
            <i class="fas fa-rotate-right"></i> Drehen 90¬∞
          </button>
          <button class="btn" onclick="flipStage()">
            <i class="fas fa-arrows-left-right"></i> Spiegeln
          </button>
          <button class="btn" onclick="resetAll()">
            <i class="fas fa-undo-alt"></i> Reset
          </button>
        </div>
        
        <div class="control-row">
          <button class="btn btn-accent" id="shadowModeBtn" style="flex: 1;">
            <i class="fas fa-moon"></i> Schatten-Modus AKTIVIEREN
          </button>
          <button class="btn" id="fullscreenBtn">
            <i class="fas fa-expand"></i>
          </button>
        </div>
        
        <div style="background: #f9f9f9; border-radius: 20px; padding: 12px; margin-top: 16px; font-size: 13px; color: #555;">
          <i class="fas fa-lightbulb" style="color: #d4af37;"></i>
          Tipp: Im Schatten-Modus bleibt das Display an. Lege das Ger√§t mit dem Bildschirm nach unten √ºber die Torte und zeichne die schwarzen Linien nach.
        </div>
      </div>
    </div>
    
    <!-- Canvas Area -->
    <div class="canvas-container">
      <div class="canvas-header">
        <div class="canvas-title">
          <i class="fas fa-circle"></i> Vorschau (runde Torte)
        </div>
        <div class="canvas-controls">
          <span class="badge" id="drawStatus"><i class="fas fa-paint-brush"></i> Zeichnen: AUS</span>
        </div>
      </div>
      
      <!-- Stage Wrapper -->
      <div class="stage-wrapper" id="stageWrapper">
        <div class="stage" id="stage">
          <svg id="svg" viewBox="0 0 1000 1000">
            <!-- Hintergrund (wei√ü) -->
            <rect width="1000" height="1000" fill="white" />
            
            <!-- Hauptkreis (Torte) -->
            <circle id="mainCircle" cx="500" cy="500" r="420" fill="none" stroke="#111" stroke-width="2.5" opacity="0.4" />
            <circle id="innerCircle" cx="500" cy="500" r="405" fill="none" stroke="#111" stroke-width="1.5" opacity="0.2" />
            
            <!-- Hilfslinien (dezent) -->
            <g id="grid" opacity="0.1" stroke="#111" stroke-width="1">
              <line x1="500" y1="50" x2="500" y2="950" />
              <line x1="50" y1="500" x2="950" y2="500" />
            </g>
            
            <!-- Alters-Zahl -->
            <g id="ageGroup" transform="translate(500 500)">
              <text id="ageText" x="0" y="0" text-anchor="middle" dominant-baseline="middle" fill="#111" font-size="220" font-weight="800" opacity="0.18"></text>
            </g>
            
            <!-- Kunden-Text -->
            <g id="textGroup" transform="translate(500 500)">
              <text id="custLabel" x="0" y="0" text-anchor="middle" dominant-baseline="middle" fill="#111" font-size="70" opacity="0.95"></text>
            </g>
            
            <!-- Motiv Gruppe -->
            <g id="motifGroup" transform="translate(500 500)" fill="none" stroke="#111" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" opacity="0.95"></g>
            
            <!-- Freihand Gruppe -->
            <g id="drawGroup" transform="translate(500 500)" fill="none" stroke="#111" stroke-linecap="round" stroke-linejoin="round"></g>
          </svg>
        </div>
      </div>
      
      <!-- Status & Info -->
      <div style="display: flex; justify-content: space-between; font-size: 13px; color: #666; margin-top: 8px;">
        <span><i class="fas fa-ruler"></i> <span id="scaleInfo">20 cm | 4.2 px/mm</span></span>
        <span><i class="fas fa-moon"></i> <span id="shadowStatus">Normal-Modus</span></span>
      </div>
    </div>
  </div>
  
  <div class="footer">
    <i class="fas fa-copyright"></i> Sanremo Torten-Schablone Pro ‚Ä¢ Perfekt f√ºr Schokoladen-Dekoration ‚Ä¢ v2.0
  </div>
  
  <script>
    (function() {
      // ==================== STATE ====================
      const state = {
        diameterCm: 20,
        pxPerMm: 4.2,
        
        customerText: "Alles Gute zum Geburtstag!",
        fontChoice: "Great Vibes",
        textScale: 100,
        textX: 0,
        textY: 0,
        
        age: 0,
        ageScale: 150,
        ageY: -40,
        
        motif: "none",
        motifScale: 120,
        motifX: 0,
        motifY: -60,
        motifRot: 0,
        
        drawMode: false,
        drawWidth: 6,
        drawScale: 100,
        drawX: 0,
        drawY: 60,
        drawRot: 0,
        
        stageRot: 0,
        stageFlip: false,
        shadowMode: false,
        
        paths: [],
        currentPath: null,
        
        wakeLock: null
      };
      
      // DOM Elements
      const $ = id => document.getElementById(id);
      
      // ==================== INITIALIZE ====================
      function init() {
        setupEventListeners();
        setupMotifGrid();
        fillAgeOptions();
        render();
        updateUIFromState();
        requestAnimationFrame(() => renderScale());
      }
      
      function setupEventListeners() {
        // Gr√∂√üe
        document.querySelectorAll('[onclick^="setDiameter"]').forEach(btn => {
          const match = btn.getAttribute('onclick').match(/\d+/);
          if (match) {
            const cm = parseInt(match[0]);
            btn.addEventListener('click', (e) => {
              e.preventDefault();
              setDiameter(cm);
            });
          }
        });
        
        // Range Inputs
        const ranges = [
          'pxPerMm', 'textScale', 'textX', 'textY',
          'ageScale', 'ageY', 'motifScale', 'motifRot', 'motifX', 'motifY',
          'drawWidth', 'drawScale', 'drawRot', 'drawX', 'drawY'
        ];
        
        ranges.forEach(id => {
          const el = $(id);
          if (el) {
            el.addEventListener('input', (e) => {
              const value = parseFloat(e.target.value);
              const stateKey = id;
              if (stateKey in state) {
                state[stateKey] = value;
                $(id + 'Value').textContent = value;
                render();
              }
            });
          }
        });
        
        // Text Inputs
        $('customerText').addEventListener('input', (e) => {
          state.customerText = e.target.value;
          render();
        });
        
        $('fontChoice').addEventListener('change', (e) => {
          state.fontChoice = e.target.value;
          render();
        });
        
        $('age').addEventListener('change', (e) => {
          state.age = parseInt(e.target.value) || 0;
          render();
        });
        
        // Buttons
        $('drawToggleBtn').addEventListener('click', toggleDrawMode);
        $('clearDrawBtn').addEventListener('click', clearDrawing);
        $('undoDrawBtn').addEventListener('click', undoDrawing);
        $('shadowModeBtn').addEventListener('click', toggleShadowMode);
        $('fullscreenBtn').addEventListener('click', toggleFullscreen);
        
        // Drawing Events
        const stage = $('stage');
        let drawing = false;
        
        stage.addEventListener('pointerdown', (e) => {
          if (!state.drawMode) return;
          drawing = true;
          stage.setPointerCapture(e.pointerId);
          const point = clientToSVG(e.clientX, e.clientY);
          startStroke(point.x, point.y);
        });
        
        stage.addEventListener('pointermove', (e) => {
          if (!drawing || !state.drawMode) return;
          const point = clientToSVG(e.clientX, e.clientY);
          continueStroke(point.x, point.y);
        });
        
        stage.addEventListener('pointerup', () => {
          if (drawing) {
            drawing = false;
            endStroke();
          }
        });
        
        stage.addEventListener('pointercancel', () => {
          if (drawing) {
            drawing = false;
            endStroke();
          }
        });
        
        // Wake Lock on visibility
        document.addEventListener('visibilitychange', async () => {
          if (state.shadowMode && document.visibilityState === 'visible') {
            await requestWakeLock();
          }
        });
        
        // Window resize
        window.addEventListener('resize', () => {
          renderScale();
        });
      }
      
      function setupMotifGrid() {
        const options = document.querySelectorAll('.motif-option');
        options.forEach(opt => {
          opt.addEventListener('click', () => {
            options.forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
            const motif = opt.dataset.motif;
            state.motif = motif;
            render();
          });
        });
      }
      
      function fillAgeOptions() {
        const select = $('age');
        select.innerHTML = '<option value="0">Kein Alter</option>';
        for (let i = 1; i <= 20; i++) {
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = i + (i === 1 ? ' Jahr' : ' Jahre');
          select.appendChild(opt);
        }
        [30, 40, 50, 60].forEach(val => {
          const opt = document.createElement('option');
          opt.value = val;
          opt.textContent = val + ' Jahre';
          select.appendChild(opt);
        });
      }
      
      function updateUIFromState() {
        // Update range displays
        $('pxPerMmValue').textContent = state.pxPerMm;
        $('textScaleValue').textContent = state.textScale;
        $('textXValue').textContent = state.textX;
        $('textYValue').textContent = state.textY;
        $('ageScaleValue').textContent = state.ageScale;
        $('ageYValue').textContent = state.ageY;
        $('motifScaleValue').textContent = state.motifScale;
        $('motifRotValue').textContent = state.motifRot;
        $('motifXValue').textContent = state.motifX;
        $('motifYValue').textContent = state.motifY;
        $('drawWidthValue').textContent = state.drawWidth;
        $('drawScaleValue').textContent = state.drawScale;
        $('drawRotValue').textContent = state.drawRot;
        $('drawXValue').textContent = state.drawX;
        $('drawYValue').textContent = state.drawY;
        
        // Update selects
        $('age').value = state.age;
        $('fontChoice').value = state.fontChoice;
        $('customerText').value = state.customerText;
        
        // Update motif grid
        document.querySelectorAll('.motif-option').forEach(opt => {
          if (opt.dataset.motif === state.motif) {
            opt.classList.add('selected');
          } else {
            opt.classList.remove('selected');
          }
        });
        
        // Update draw button
        $('drawToggleBtn').innerHTML = state.drawMode ? 
          '<i class="fas fa-paint-brush"></i> Zeichenmodus: AN' : 
          '<i class="fas fa-paint-brush"></i> Zeichenmodus: AUS';
        $('drawStatus').innerHTML = state.drawMode ? 
          '<i class="fas fa-paint-brush"></i> Zeichnen: AN' : 
          '<i class="fas fa-paint-brush"></i> Zeichnen: AUS';
        
        // Update shadow button
        $('shadowModeBtn').innerHTML = state.shadowMode ?
          '<i class="fas fa-sun"></i> Normal-Modus' :
          '<i class="fas fa-moon"></i> Schatten-Modus AKTIVIEREN';
        
        $('mode-badge').innerHTML = state.shadowMode ?
          '<i class="fas fa-moon"></i><span>Schatten-Modus</span>' :
          '<i class="fas fa-sun"></i><span>Normal</span>';
        
        $('shadowStatus').textContent = state.shadowMode ? 'Schatten-Modus' : 'Normal-Modus';
        $('size-display').textContent = state.diameterCm + ' cm';
      }
      
      // ==================== RENDERING ====================
      function render() {
        const shadow = state.shadowMode;
        const color = shadow ? '#000000' : '#111111';
        
        // Set colors
        setStrokeColor(color);
        
        // Customer Text
        const custLabel = $('custLabel');
        custLabel.textContent = state.customerText;
        custLabel.style.fontFamily = `'${state.fontChoice}', cursive, sans-serif`;
        custLabel.setAttribute('opacity', shadow ? '1' : '0.95');
        applyTransform('textGroup', state.textX, state.textY, state.textScale, 0);
        
        // Age
        const ageText = $('ageText');
        ageText.textContent = state.age > 0 ? state.age.toString() : '';
        ageText.setAttribute('opacity', shadow ? '0.2' : '0.18');
        applyTransform('ageGroup', 0, state.ageY, state.ageScale, 0);
        
        // Motif
        renderMotif();
        
        // Drawing
        renderDrawing();
        
        // Stage transforms
        const stage = $('stage');
        const flip = state.stageFlip ? -1 : 1;
        stage.style.transform = `scaleX(${flip}) rotate(${state.stageRot}deg)`;
        
        renderScale();
        updateUIFromState();
      }
      
      function setStrokeColor(color) {
        $('mainCircle').setAttribute('stroke', color);
        $('innerCircle').setAttribute('stroke', color);
        $('grid').setAttribute('stroke', color);
        $('custLabel').setAttribute('fill', color);
        $('ageText').setAttribute('fill', color);
        $('motifGroup').setAttribute('stroke', color);
        $('drawGroup').setAttribute('stroke', color);
      }
      
      function applyTransform(groupId, x, y, scalePct, rot) {
        const g = $(groupId);
        if (!g) return;
        const s = scalePct / 100;
        g.setAttribute('transform', `translate(${500 + x} ${500 + y}) rotate(${rot}) scale(${s})`);
      }
      
      function renderMotif() {
        const mg = $('motifGroup');
        mg.innerHTML = '';
        
        if (state.motif === 'none') {
          mg.setAttribute('opacity', '0');
          return;
        }
        
        mg.setAttribute('opacity', state.shadowMode ? '1' : '0.95');
        mg.setAttribute('stroke-width', state.shadowMode ? '10' : '8');
        
        const paths = getMotifPaths(state.motif);
        paths.forEach(d => {
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          path.setAttribute('d', d);
          mg.appendChild(path);
        });
        
        applyTransform('motifGroup', state.motifX, state.motifY, state.motifScale, state.motifRot);
      }
      
      function getMotifPaths(motif) {
        const center = (cx, cy, r) => `M ${cx+r} ${cy} A ${r} ${r} 0 1 0 ${cx-r} ${cy} A ${r} ${r} 0 1 0 ${cx+r} ${cy}`;
        
        switch(motif) {
          case 'heart':
            return ["M 0 100 C -100 -50 -50 -150 0 -80 C 50 -150 100 -50 0 100 Z"];
          case 'star':
            return ["M 0 -150 L 35 -45 L 145 -45 L 55 20 L 90 130 L 0 65 L -90 130 L -55 20 L -145 -45 L -35 -45 Z"];
          case 'crown':
            return ["M -130 40 L -80 -80 L -20 20 L 0 -40 L 20 20 L 80 -80 L 130 40 L 100 80 L -100 80 Z"];
          case 'bear':
            return [
              center(0, -40, 120),
              center(-70, -130, 40),
              center(70, -130, 40),
              center(-35, -60, 10),
              center(35, -60, 10),
              "M -50 20 Q 0 60 50 20"
            ];
          case 'dog':
            return [
              center(0, -20, 100),
              center(-60, -100, 30),
              center(60, -100, 30),
              "M -70 30 Q -20 70 0 70 Q 20 70 70 30",
              center(-35, -40, 8),
              center(35, -40, 8)
            ];
          case 'cat':
            return [
              "M -100 -50 C -140 -100 -40 -140 0 -100 C 40 -140 140 -100 100 -50",
              "M -80 0 L -130 40",
              "M 80 0 L 130 40",
              center(-30, 20, 8),
              center(30, 20, 8),
              "M -40 60 Q 0 100 40 60"
            ];
          case 'dino':
            return [
              "M -150 0 C -180 -80 -60 -140 0 -120 C 80 -140 180 -60 150 20 C 140 80 80 120 0 120 C -80 120 -140 80 -150 0",
              "M -100 20 L -150 60",
              "M 100 20 L 150 60",
              "M -40 100 L -60 160 L -20 160 L -20 120",
              "M 40 100 L 60 160 L 20 160 L 20 120"
            ];
          case 'unicorn':
            return [
              "M -120 -20 C -150 -100 -50 -150 0 -140 C 60 -150 140 -90 120 -20 C 110 50 60 100 0 100 C -60 100 -110 50 -120 -20",
              "M 0 -180 L 40 -120 L 0 -140 L -40 -120 Z",
              center(-40, -40, 8),
              center(40, -40, 8),
              "M -70 20 Q 0 60 70 20"
            ];
          case 'car':
            return [
              "M -180 20 C -180 -40 -100 -70 0 -70 C 100 -70 180 -40 180 20 C 180 60 120 80 0 80 C -120 80 -180 60 -180 20",
              center(-120, 40, 20),
              center(120, 40, 20),
              "M -60 -70 L -60 -120",
              "M 60 -70 L 60 -120"
            ];
          case 'ball':
            return [
              center(0, 0, 120),
              "M -80 -40 L -120 -80",
              "M -40 40 L -100 100",
              "M 40 40 L 100 100",
              "M 80 -40 L 120 -80",
              "M 0 -120 L 0 120"
            ];
          case 'cake':
            return [
              "M -120 20 L -120 -60 L 120 -60 L 120 20",
              "M -150 20 L 150 20 L 120 80 L -120 80 Z",
              "M -60 -60 L -60 -100",
              "M 0 -60 L 0 -100",
              "M 60 -60 L 60 -100",
              center(-80, 50, 8),
              center(0, 50, 8),
              center(80, 50, 8)
            ];
          default:
            return [];
        }
      }
      
      function renderDrawing() {
        const dg = $('drawGroup');
        dg.innerHTML = '';
        
        applyTransform('drawGroup', state.drawX, state.drawY, state.drawScale, state.drawRot);
        
        state.paths.forEach(item => {
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          path.setAttribute('d', item.d);
          path.setAttribute('stroke-width', item.w);
          path.setAttribute('opacity', state.shadowMode ? '1' : '0.95');
          dg.appendChild(path);
        });
        
        if (state.currentPath) {
          const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
          path.setAttribute('d', state.currentPath.d);
          path.setAttribute('stroke-width', state.currentPath.w);
          path.setAttribute('opacity', state.shadowMode ? '1' : '0.95');
          dg.appendChild(path);
        }
      }
      
      function renderScale() {
        const desiredMm = state.diameterCm * 10;
        const desiredPx = desiredMm * state.pxPerMm;
        
        const wrapper = $('stageWrapper');
        const rect = wrapper.getBoundingClientRect();
        const availablePx = Math.min(rect.width, rect.height);
        
        const baseDiameter = 840; // SVG circle diameter
        const currentPx = (baseDiameter / 1000) * availablePx;
        const factor = desiredPx / currentPx;
        
        $('svg').style.transform = `scale(${factor})`;
        $('scaleInfo').textContent = `${state.diameterCm} cm | ${state.pxPerMm.toFixed(1)} px/mm`;
        
        // Calibration readout
        const cardPx = 85.6 * state.pxPerMm;
        $('calibration-readout').textContent = `Karte: ${cardPx.toFixed(0)} px auf Bildschirm`;
      }
      
      // ==================== DRAWING ====================
      function clientToSVG(clientX, clientY) {
        const svg = $('svg');
        const pt = svg.createSVGPoint();
        pt.x = clientX;
        pt.y = clientY;
        const ctm = svg.getScreenCTM();
        if (!ctm) return { x: 500, y: 500 };
        const inv = ctm.inverse();
        const sp = pt.matrixTransform(inv);
        return { x: sp.x, y: sp.y };
      }
      
      function startStroke(x, y) {
        const dg = $('drawGroup');
        const pt = $('svg').createSVGPoint();
        pt.x = x;
        pt.y = y;
        const m = dg.getCTM();
        if (!m) return;
        const inv = m.inverse();
        const lp = pt.matrixTransform(inv);
        state.currentPath = {
          d: `M ${lp.x.toFixed(2)} ${lp.y.toFixed(2)}`,
          w: state.drawWidth
        };
        renderDrawing();
      }
      
      function continueStroke(x, y) {
        if (!state.currentPath) return;
        const dg = $('drawGroup');
        const pt = $('svg').createSVGPoint();
        pt.x = x;
        pt.y = y;
        const m = dg.getCTM();
        if (!m) return;
        const inv = m.inverse();
        const lp = pt.matrixTransform(inv);
        state.currentPath.d += ` L ${lp.x.toFixed(2)} ${lp.y.toFixed(2)}`;
        renderDrawing();
      }
      
      function endStroke() {
        if (state.currentPath) {
          state.paths.push(state.currentPath);
          state.currentPath = null;
        }
        renderDrawing();
      }
      
      function clearDrawing() {
        state.paths = [];
        state.currentPath = null;
        renderDrawing();
      }
      
      function undoDrawing() {
        state.paths.pop();
        renderDrawing();
      }
      
      function toggleDrawMode() {
        state.drawMode = !state.drawMode;
        updateUIFromState();
      }
      
      // ==================== SHADOW MODE ====================
      async function toggleShadowMode() {
        state.shadowMode = !state.shadowMode;
        
        if (state.shadowMode) {
          $('stage').classList.add('shadow-mode');
          await requestWakeLock();
        } else {
          $('stage').classList.remove('shadow-mode');
          await releaseWakeLock();
        }
        
        render();
        updateUIFromState();
      }
      
      async function requestWakeLock() {
        try {
          if ('wakeLock' in navigator) {
            state.wakeLock = await navigator.wakeLock.request('screen');
          }
        } catch (err) {
          console.warn('Wake Lock failed:', err);
        }
      }
      
      async function releaseWakeLock() {
        try {
          if (state.wakeLock) {
            await state.wakeLock.release();
            state.wakeLock = null;
          }
        } catch (err) {
          console.warn('Release Wake Lock failed:', err);
        }
      }
      
      // ==================== ACTIONS ====================
      window.setDiameter = function(cm) {
        state.diameterCm = cm;
        render();
        updateUIFromState();
      };
      
      window.rotateStage = function() {
        state.stageRot = (state.stageRot + 90) % 360;
        render();
      };
      
      window.flipStage = function() {
        state.stageFlip = !state.stageFlip;
        render();
      };
      
      window.resetAll = function() {
        state.textScale = 100;
        state.textX = 0;
        state.textY = 0;
        state.age = 0;
        state.ageScale = 150;
        state.ageY = -40;
        state.motif = 'none';
        state.motifScale = 120;
        state.motifX = 0;
        state.motifY = -60;
        state.motifRot = 0;
        state.drawMode = false;
        state.drawScale = 100;
        state.drawX = 0;
        state.drawY = 60;
        state.drawRot = 0;
        state.stageRot = 0;
        state.stageFlip = false;
        state.paths = [];
        state.currentPath = null;
        
        render();
        updateUIFromState();
      };
      
      function toggleFullscreen() {
        document.body.classList.toggle('fullscreen-mode');
        $('fullscreenBtn').innerHTML = document.body.classList.contains('fullscreen-mode') ?
          '<i class="fas fa-compress"></i>' :
          '<i class="fas fa-expand"></i>';
        setTimeout(() => renderScale(), 100);
      }
      
      // ==================== START ====================
      init();
    })();
  </script>
</body>
</html>
