<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SANREMO - C√ÇMARA + DESENHO</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background: #000;
      color: white;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
    }

    /* Container principal */
    .container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    /* C√¢mara */
    .camera-box {
      position: relative;
      flex: 1;
      width: 100%;
      background: #000;
      overflow: hidden;
    }

    #video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* CANVAS DE SOBREPOSI√á√ÉO - VIS√çVEL */
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      pointer-events: none;
    }

    /* Controlos */
    .controls {
      background: #111;
      padding: 15px;
      border-top: 2px solid #FFD700;
      z-index: 20;
    }

    .input-group {
      margin-bottom: 10px;
    }

    input, select {
      width: 100%;
      padding: 12px;
      border-radius: 25px;
      border: 1px solid #333;
      background: #222;
      color: white;
      font-size: 16px;
    }

    .slider-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .slider-group label {
      width: 60px;
      color: #FFD700;
    }

    input[type=range] {
      flex: 1;
    }

    .button-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    button {
      flex: 1;
      padding: 15px;
      border-radius: 30px;
      border: none;
      background: #333;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    .shadow-btn {
      background: #FFD700;
      color: black;
    }

    .shadow-btn.active {
      background: #333;
      color: #FFD700;
    }

    .status {
      text-align: center;
      color: #FFD700;
      margin-top: 5px;
      font-size: 14px;
    }
  </style>
</head>
<body>
<div class="container">
  <!-- C√¢mara + Desenho -->
  <div class="camera-box">
    <video id="video" autoplay playsinline></video>
    <canvas id="overlay"></canvas>
  </div>

  <!-- Controlos -->
  <div class="controls">
    <div class="input-group">
      <input type="text" id="textInput" value="Parab√©ns!" placeholder="Texto...">
    </div>

    <div class="slider-group">
      <label>Tamanho</label>
      <input type="range" id="sizeSlider" min="30" max="200" value="80">
    </div>

    <div class="slider-group">
      <label>Posi√ß√£o Y</label>
      <input type="range" id="ySlider" min="-200" max="200" value="0">
    </div>

    <div class="button-row">
      <button id="fontBtn">üìù Fonte</button>
      <button id="colorBtn">üé® Cor</button>
      <button id="shadowBtn" class="shadow-btn">üåô SOMBRA</button>
    </div>

    <div class="status" id="statusText">
      üåô Clique em SOMBRA para ver o desenho
    </div>
  </div>
</div>

<!-- Modal Fonte -->
<div id="fontModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center;">
  <div style="background: #222; padding: 30px; border-radius: 30px; width: 80%; max-width: 400px;">
    <h3 style="color: #FFD700; margin-bottom: 20px;">Escolher Fonte</h3>
    <select id="fontSelect" style="width: 100%; padding: 15px; margin-bottom: 20px;">
      <option value="Arial">Arial</option>
      <option value="'Great Vibes'">Great Vibes</option>
      <option value="'Pacifico'">Pacifico</option>
      <option value="'Comic Sans MS'">Comic Sans</option>
      <option value="Georgia">Georgia</option>
    </select>
    <button onclick="closeFontModal()" style="width: 100%; background: #FFD700; color: black;">OK</button>
  </div>
</div>

<!-- Modal Cor -->
<div id="colorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; justify-content: center; align-items: center;">
  <div style="background: #222; padding: 30px; border-radius: 30px; width: 80%; max-width: 400px;">
    <h3 style="color: #FFD700; margin-bottom: 20px;">Escolher Cor</h3>
    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
      <div onclick="setColor('#FFD700')" style="background: #FFD700; height: 60px; border-radius: 15px;"></div>
      <div onclick="setColor('#FF0000')" style="background: #FF0000; height: 60px; border-radius: 15px;"></div>
      <div onclick="setColor('#00FF00')" style="background: #00FF00; height: 60px; border-radius: 15px;"></div>
      <div onclick="setColor('#0000FF')" style="background: #0000FF; height: 60px; border-radius: 15px;"></div>
      <div onclick="setColor('#FF00FF')" style="background: #FF00FF; height: 60px; border-radius: 15px;"></div>
      <div onclick="setColor('#FFFFFF')" style="background: #FFFFFF; height: 60px; border-radius: 15px;"></div>
    </div>
    <button onclick="closeColorModal()" style="width: 100%; background: #FFD700; color: black;">OK</button>
  </div>
</div>

<script>
  // Elementos
  const video = document.getElementById('video');
  const overlay = document.getElementById('overlay');
  const ctx = overlay.getContext('2d');

  // Estado
  let shadowMode = false;
  let text = "Parab√©ns!";
  let font = "Arial";
  let size = 80;
  let yPos = 0;
  let color = "#FFD700";

  // ===== INICIAR C√ÇMARA =====
  async function startCamera() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: 'environment' } 
      });
      video.srcObject = stream;
      
      video.onloadedmetadata = () => {
        // Ajustar canvas ao tamanho do v√≠deo
        overlay.width = video.videoWidth;
        overlay.height = video.videoHeight;
        drawLoop();
      };
    } catch (err) {
      alert('Erro: N√£o foi poss√≠vel aceder √† c√¢mara');
    }
  }

  // ===== DESENHAR SOBREPOSI√á√ÉO =====
  function drawLoop() {
    draw();
    requestAnimationFrame(drawLoop);
  }

  function draw() {
    // Limpar canvas (deixar transparente)
    ctx.clearRect(0, 0, overlay.width, overlay.height);
    
    // Centro do ecr√£
    const centerX = overlay.width / 2;
    const centerY = overlay.height / 2;
    const radius = Math.min(overlay.width, overlay.height) * 0.3;
    
    // Configurar estilo - MODO SOMBRA vs NORMAL
    if (shadowMode) {
      ctx.strokeStyle = color;
      ctx.fillStyle = color;
      ctx.shadowColor = color;
      ctx.shadowBlur = 20;
      ctx.lineWidth = 10;
    } else {
      ctx.strokeStyle = '#FFFFFF';
      ctx.fillStyle = '#FFFFFF';
      ctx.shadowColor = '#000000';
      ctx.shadowBlur = 10;
      ctx.lineWidth = 8;
    }
    
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;
    
    // Desenhar c√≠rculo da torta
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
    ctx.stroke();
    
    // Segundo c√≠rculo (interior)
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius * 0.95, 0, Math.PI * 2);
    ctx.strokeStyle = shadowMode ? color : '#CCCCCC';
    ctx.stroke();
    
    // Linhas de centro (fracas)
    ctx.globalAlpha = 0.3;
    ctx.beginPath();
    ctx.moveTo(centerX, centerY - radius * 1.2);
    ctx.lineTo(centerX, centerY + radius * 1.2);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(centerX - radius * 1.2, centerY);
    ctx.lineTo(centerX + radius * 1.2, centerY);
    ctx.stroke();
    ctx.globalAlpha = 1;
    
    // Desenhar texto
    ctx.font = `${size}px ${font}`;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillStyle = shadowMode ? color : '#FFFFFF';
    ctx.fillText(text, centerX, centerY + yPos);
  }

  // ===== EVENTOS =====
  
  // Texto
  document.getElementById('textInput').addEventListener('input', (e) => {
    text = e.target.value;
  });

  // Tamanho
  document.getElementById('sizeSlider').addEventListener('input', (e) => {
    size = parseInt(e.target.value);
  });

  // Posi√ß√£o Y
  document.getElementById('ySlider').addEventListener('input', (e) => {
    yPos = parseInt(e.target.value);
  });

  // Bot√£o Sombra
  document.getElementById('shadowBtn').addEventListener('click', () => {
    shadowMode = !shadowMode;
    const btn = document.getElementById('shadowBtn');
    const status = document.getElementById('statusText');
    
    if (shadowMode) {
      btn.textContent = '‚òÄÔ∏è NORMAL';
      btn.classList.add('active');
      status.innerHTML = '‚ú® MODO SOMBRA ATIVO - Desenho colorido';
      requestWakeLock();
    } else {
      btn.textContent = 'üåô SOMBRA';
      btn.classList.remove('active');
      status.innerHTML = 'üåô Clique em SOMBRA para ver o desenho';
      releaseWakeLock();
    }
  });

  // Fonte
  document.getElementById('fontBtn').addEventListener('click', () => {
    document.getElementById('fontModal').style.display = 'flex';
  });

  window.closeFontModal = () => {
    font = document.getElementById('fontSelect').value;
    document.getElementById('fontModal').style.display = 'none';
  };

  // Cor
  document.getElementById('colorBtn').addEventListener('click', () => {
    document.getElementById('colorModal').style.display = 'flex';
  });

  window.setColor = (c) => {
    color = c;
  };

  window.closeColorModal = () => {
    document.getElementById('colorModal').style.display = 'none';
  };

  // Wake Lock
  let wakeLock = null;
  
  async function requestWakeLock() {
    try {
      if ('wakeLock' in navigator) {
        wakeLock = await navigator.wakeLock.request('screen');
      }
    } catch (err) {}
  }
  
  async function releaseWakeLock() {
    try {
      if (wakeLock) {
        await wakeLock.release();
        wakeLock = null;
      }
    } catch (err) {}
  }

  // Iniciar
  startCamera();
</script>
</body>
</html>
